{"version":3,"sources":["spa-public-validator.js"],"names":["factory","define","cmd","require","exports","module","window","isEmpty","value","registAPI","name","callback","is","console","warn","not","objectType","Object","prototype","toString","utils","isArray","obj","type","TYPE_ARRAY","isFunction","TYPE_FUNCTION","getValue","htmlElement","getAttribute","getChecker","parts","split","replace","checker","defaults","checkers","TypeError","params","_params","slice","getLengthParams","paramString","matcher","result","match","min","max","Infinite","call","TYPE_STRING","TYPE_REGEXP","Validator","this","rules","vprtt","add","concat","push","remove","i","len","length","j","splice","createFormValidator","formOrSelector","validations","FormValidator","$form","document","querySelectorAll","fields","field","$field","constructor","check","pass","rule","values","k","unshift","apply","context","fail","notEmpty","ruleName","testString","lenght","api","apiName","_type","test","_checker","list"],"mappings":"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","file":"spa-public-validator.min.js","sourcesContent":["(function(factory) {\r\n  if (typeof define === 'function' && define.cmd) {\r\n    define(function(require, exports, module) {\r\n      factory(exports);\r\n    });\r\n  } else {\r\n    factory(window)\r\n  }\r\n}(function(exports) {\r\n\nvar objectType = Object.prototype.toString;\r\n\r\nvar hasOwn = function(p) {\r\n  return this.hasOwnProperty(p);\r\n};\r\n\r\nvar utils = {};\r\n\r\nutils.isArray = function(obj) {\r\n  return utils.type(obj) === utils.TYPE_ARRAY;\r\n};\r\n\r\nutils.isFunction = function(obj) {\r\n  return utils.type(obj) === utils.TYPE_FUNCTION;\r\n};\r\n\r\nutils.getValue = function(htmlElement) {\r\n  if (typeof htmlElement.value === 'undefined') {\r\n    return htmlElement.getAttribute('data-value') || '';\r\n  } else {\r\n    return htmlElement.value;\r\n  }\r\n};\r\n\r\n/**\r\n * getChecker\r\n * @param {String} type\r\n * @return {Array} [checkerFunction, params]\r\n */\r\nutils.getChecker = function(type) {\r\n  var parts = type.split(':');\r\n  type = parts[0].replace(/length/i, 'long');\r\n  var checker = defaults.checkers[type]; // TODO: 首先从内建规则中获取，如果内建规则中没有，再从自定义规则中获取\r\n  if (!utils.isFunction(checker)) {\r\n    throw new TypeError('Checker for rule ' + parts[0] + ' must be a Function.');\r\n  }\r\n  var params;\r\n  var _params = parts.slice(1);\r\n  switch (type) {\r\n    case 'long':\r\n      params = utils.getLengthParams(_params);\r\n      break;\r\n    default:\r\n      params = _params;\r\n  }\r\n  return [checker, params];\r\n};\r\n\r\n/**\r\n * 解析length规则的参数\r\n * @param {String} paramString\r\n * @return {Array} params\r\n * HACK: 这里的解析可以更复杂，例如，加入对布尔运算的解析\r\n */\r\nutils.getLengthParams = function(paramString) {\r\n  paramString = paramString[0]; // 暂时只做最简单的解析\r\n  var matcher = /\\s*([\\(\\[])\\s*(\\d+)?\\s*,\\s*(\\d+)?\\s*([\\)\\]])\\s*/; // 如果没有最小限制，最小限制为0；如果没有最大限制，最大限制为Infinite\r\n  var result = paramString.match(matcher);\r\n  if (result === null) {\r\n    throw new TypeError('The parameters for length is illegal.');\r\n  }\r\n  var min = result[2], max = result[3];\r\n  if (typeof min === 'undefined') {\r\n    min = 0;\r\n  } else if (result[1] === '(') {\r\n    min = +min+1;\r\n  } else if (result[1] === '[') {\r\n    min = +min;\r\n  } else {\r\n    throw new TypeError('The parameters for length is illegal.');\r\n  }\r\n  if (typeof max === 'undefined') {\r\n    max = Infinite;\r\n  } else if (result[4] === ')') {\r\n    max = +max-1;\r\n  } else if (result[4] === ']'){\r\n    max = +max;\r\n  } else {\r\n    throw new TypeError('The parameters for length is illegal.');\r\n  }\r\n  if (min !== min || max !== max) {\r\n    throw new TypeError('The parameters for length is illegal.');\r\n  }\r\n  return [min, max];\r\n};\r\n\r\n/**\r\n * Utils: Get Object Type\r\n * @param {Object} obj\r\n * @return {String} object type\r\n */\r\nutils.type = function(obj) {\r\n  return objectType.call(obj);\r\n};\r\n\r\n// Object Type Const String\r\nutils.TYPE_STRING = '[object String]';\r\nutils.TYPE_ARRAY = '[object Array]';\r\nutils.TYPE_FUNCTION = '[object Function]';\r\nutils.TYPE_REGEXP = '[object RegExp]';\r\n\n/**\r\n * @constructor\r\n * @class Validator\r\n */\r\nvar Validator = function() {\r\n  this.rules = [];\r\n};\r\n\r\nvar vprtt = Validator.prototype;\r\n\r\n/**\r\n * @method .add(rules)\r\n * 添加自定义规则\r\n * 自定义的规则，可以和内建规则同名，但调用时只会使用内建规则。如果要覆盖内建规则，就使用Validator.api（全局覆盖）\r\n * HACK: 因为自定义规则是用数组存的，所以也可能重名\r\n * @param {Object} rules\r\n * @return this\r\n */\r\nvprtt.add = function(rules) {\r\n  if (utils.isArray(rules)) {\r\n    this.rules = this.rules.concat(rules);\r\n  } else {\r\n    this.rules.push(rules);\r\n  }\r\n  return this;\r\n};\r\n\r\n/**\r\n * @method .remove(rules)\r\n * 移除自定义规则\r\n * @param {Array|String} rules\r\n * @return this\r\n */\r\nvprtt.remove = function(rules) {\r\n  if (utils.isArray(rules)) {\r\n    for (var i = 0, len = rules.length; i < len; ++i) {\r\n      for (var j = 0; j < this.rules.length; ++j) {\r\n        if (this.rules[j].name === rules[i]) {\r\n          this.rules.splice(j, 1);\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    for (var j = 0; j < this.rules.length; ++j) {\r\n      if (this.rules[j].name === rules) {\r\n        this.rules.splice(j, 1);\r\n      }\r\n    }\r\n  }\r\n  return this;\r\n};\r\n\r\n/**\r\n * @method .createFormValidator()\r\n * @param {Element|String} form|selector\r\n * @param {Object} validations\r\n */\r\nvprtt.createFormValidator = function(formOrSelector, validations) {\r\n  return new FormValidator(formOrSelector, validations);\r\n};\r\n\r\n/**\r\n * @constructor\r\n * @class FormValidator\r\n * @extends Validator\r\n * @param {HTMLElement|String} formOrSelector\r\n * @param {Object|Array} validations\r\n */\r\nvar FormValidator = function(formOrSelector, validations) {\r\n  if (typeof formOrSelector === 'string') {\r\n    this.$form = document.querySelectorAll(formOrSelector)[0];\r\n  } else {\r\n    this.$form = formOrSelector;\r\n  }\r\n  this.validations = [];\r\n  if (!utils.isArray(validations)) {\r\n    validations = [validations];\r\n  }\r\n  for (var i = 0, len = validations.length; i < len; ++i) {\r\n    var fields = validations[i].field;\r\n    if (!utils.isArray(fields)) {\r\n      fields = [fields];\r\n    }\r\n    var $field = [];\r\n    for (var j = 0; j < fields.length; ++j) {\r\n      $field.push(this.$form.querySelectorAll('[name=' + fields[j] + ']')[0]);\r\n    }\r\n    var rules = validations[i].rules;\r\n    rules = utils.isArray(rules) ? rules : [rules];\r\n    this.validations.push({\r\n      $field: $field,\r\n      rules: rules\r\n    });\r\n  }\r\n}\r\n\r\nFormValidator.prototype = new Validator();\r\nFormValidator.prototype.constructor = FormValidator;\r\n\r\n/**\r\n * @method .check()\r\n * @return {Boolean} pass or not\r\n */\r\nFormValidator.prototype.check = function() {\r\n  var $form = this.$form;\r\n  var validations = this.validations;\r\n  var pass = true;\r\n  for (var i = 0, len = validations.length; i < len; ++i) {\r\n    var $field = validations[i].$field;\r\n    var rules = validations[i].rules;\r\n    for (var j = 0; j < rules.length; ++j) {\r\n      var rule = rules[j];\r\n      var checker = utils.getChecker(rule.type);\r\n      var values  = [];\r\n      for (var k = 0; k < $field.length; ++k) {\r\n        values.push(utils.getValue($field[k]));\r\n      }\r\n      checker[1].unshift(values);\r\n      if (!checker[0].apply(null, checker[1])) {\r\n        var context = $field.length < 2 ? $field[0] : $field;\r\n        rule.fail.call(context, $form);\r\n        pass = false;\r\n        break;\r\n      }\r\n    }\r\n    if (!pass) break;\r\n  }\r\n  return pass;\r\n};\r\n\nvar rules = ['empty', 'length', 'email', 'url', 'yes']; // 内置规则\n\nvar matchers = {\n  ////////// 正则匹配\n  url: /^(https?:\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]{2,6})([\\/\\w \\.-]*)*\\/?$/,\n  email: /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$/i,\n  ////////// 非正则匹配\n  empty: isEmpty\n};\n\n/**\n * 判断值是否为空\n * @param {Object} value\n * 如果value为null|undefined|空字符串，就判断为真，否则判断为假\n * @return {Boolean} 是否为空\n */\nfunction isEmpty(value) {\n  return value === null || typeof value === 'undefined' || value === '';\n}\n\nvar defaults = {};\n\n// TODO: checker函数总是接收（唯一）一个字符串数组作为参数\nvar checkers = {};\n\n/**\n * checker: not empty\n * @param {Array} values\n * @return {Boolean} yes or no\n */\ncheckers.notEmpty = function(values) {\n  var pass = true;\n  for (var i = 0, len = values.length; i < len; ++i) {\n    if (isEmpty(values[i])) {\n      pass = false;\n      break;\n    }\n  }\n  return pass;\n};\n\n/**\n * checker: length limit\n * @param {Array} values\n * @param {Number} min\n * @param {Number} max\n * @return {Boolean} yes or no\n */\ncheckers.long = function(values, min, max) {\n  var pass = true;\n  for (var i = 0, len = values.length; i < len; ++i) {\n    var length = values[i].length;\n    if (length < min || length > max) {\n      pass = false;\n      break;\n    }\n  }\n  return pass;\n};\n\ndefaults.checkers = checkers;\n\n/**\r\n * @static Validator.is\r\n * @param {String} ruleName\r\n * @param {String} testString\r\n * @return {Boolean} is or not\r\n */\r\nvar is = function(ruleName, testString) {\r\n  return is[ruleName](testString);\r\n};\r\n\r\n/**\r\n * @static Validator.not\r\n * @param {String} ruleName\r\n * @param {String} testString\r\n * @return {Boolean} is or not\r\n */\r\nvar not = function(ruleName, testString) {\r\n  return not[ruleName](testString);\r\n};\r\n\r\nValidator.is = is;\r\n\r\nValidator.not = not;\r\n\r\n/**\r\n * This helper helps to regist api\r\n * @param {String} name\r\n * @param {Function} callback\r\n */\r\nfunction registAPI(name, callback) {\r\n  if (typeof is[name] !== 'undefined') {\r\n    console.warn('Warning: current api \"' + name + '\" will be overwritten.');\r\n  }\r\n  is[name] = callback;\r\n  not[name] = function(value) {\r\n    return !is[name](value);\r\n  };\r\n}\r\n\r\nValidator.not = not;\r\n\r\n// 注册内建规则\r\nfor (var i = 0, len = rules.lenght; i < len; ++i) {\r\n  registAPI(rules[i], defaults.checkers[rules[i]]);\r\n}\r\n\r\n/**\r\n * @static Validator.api(type, apiName, checker)\r\n * @param {String} type\r\n * @param {String} apiName\r\n * @param {String|RegExp|Function} checker\r\n * checker可以是字符串，正则表达式，或者函数\r\n * 当checker是字符串时，表示基于内建的规则添加的新规则（其实完全可以用内建规则实现）\r\n * 当checker是正则表达式时，表示一条通过该正则表达式测试的规则\r\n * 当checker是函数时，该函数的返回值必须是布尔\r\n * This function may throw a `TypeError` if checker's type is not support.\r\n * @return Validator\r\n */\r\nValidator.api = function(type, apiName, checker) {\r\n  var _type = utils.type(checker);\r\n  if (!/is|not/.test(type)) {\r\n    throw new TypeError('The api type \"' + type + '\" is not support.');\r\n  }\r\n  var is = type === 'is';\r\n  var callback;\r\n  switch(_type) {\r\n    case utils.TYPE_STRING:\r\n      var parts = checker.split(':');\r\n      var _checker = defaults.checkers[parts[0]];\r\n      if (typeof _checker === 'undefined') {\r\n        throw new TypeError('Checker ' + parts[0] + ' is not defined.');\r\n      }\r\n      callback = function(value) {\r\n        var result = _checker.call(this, parts.slice(1));\r\n        return is ?  result: !result;\r\n      };\r\n      break;\r\n    case utils.TYPE_REGEXP:\r\n      callback = function(value) {\r\n        var result = checker.test(value);\r\n        return is ? result : !result;\r\n      }\r\n      break;\r\n    case utils.TYPE_FUNCTION:\r\n      callback = checker;\r\n      break;\r\n    default:\r\n      throw new TypeError('Checker must be a String/RegExp/Function.');\r\n  }\r\n  registAPI(apiName, callback);\r\n  return Validator;\r\n};\r\n\r\n/**\r\n * list all registed api\r\n */\r\nValidator.api.list = function() {\r\n  return rules;\r\n};\r\n\n\r\nexports.Validator = Validator;\r\n\r\n}));\r\n"],"sourceRoot":"/source/"}