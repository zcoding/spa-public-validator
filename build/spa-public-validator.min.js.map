{"version":3,"sources":["spa-public-validator.js"],"names":["factory","window","exports","getType","obj","Object","prototype","toString","call","isArray","TYPE_ARRAY","getValue","htmlElement","value","getAttribute","priority","v1","v2","priorityTable","parseRules","ruleString","c","wordQueue","exQueue","opStack","i","word","op","len","length","push","j","pop","execFn","type","values","isApi","parts","split","replace","result","checker","apiCheckers","defaultCheckers","this","cs","calculateRules","TYPE_FUNCTION","params","_params","slice","utils","getLengthParams","getRangeParams","unshift","_values","k","apply","TypeError","ruleQueue","ruleStack","exp","s2","s1","TYPE_STRING","Validator","validations","vs","fields","field","rules","queue","$fs","rs","isEmpty","TYPE_UNDEFINED","equal","empty","pass","long","min","max","Infinity","range","leftEqual","rightEqual","Number","registDefaultCheckers","name","matcher","callback","TYPE_REGEXP","test","is","not","arguments","registApiChecker","err","Error","hasOwn","p","hasOwnProperty","trim","str","paramString","errorString","match","||","&&","!","vprtt","add","setRule","rule","error","check","$fields","context","fail","remove","removeRule","defaultMatchers","url","email","number","int","positive","negative","varName","nickName","QQ","ip","ipv4","ipv6","upperCase","lowerCase","ruleName","m","api","list","console","log","FormValidator","formOrSelector","$form","document","querySelectorAll","$field","constructor"],"mappings":"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","file":"spa-public-validator.min.js","sourcesContent":["(function(factory) {\r\n    factory(window);\r\n}(function(exports) {\r\n\n// 为了兼容不支持querySelectorAll的浏览器，同时又不需要使用jQuery，使用原生API获取元素\r\n// 只是为了获取特定元素，所以只支持简单的选择器\r\n\r\n/**\r\n * query inputs\r\n * 这个函数是不完整的！不公开使用\r\n * @param {HTMLElement} form\r\n * @return {Array} element list\r\n */\r\nvar queryInputs = function(form) {\r\n  // var inputs = form.getElementsByTagName('input');\r\n  // var textareas = form.getElementsByTagName('textarea');\r\n};\r\n\n// shortcut\r\nvar hasOwn = function(p) {\r\n  return this.hasOwnProperty(p);\r\n};\r\n\r\n// Object Type Const String\r\nvar TYPE_STRING = '[object String]'\r\n  , TYPE_ARRAY = '[object Array]'\r\n  , TYPE_FUNCTION = '[object Function]'\r\n  , TYPE_REGEXP = '[object RegExp]'\r\n  , TYPE_UNDEFINED = 'undefined';\r\n\r\nvar utils = {};\r\n\r\n/**\r\n * Utils: Get Object Type\r\n * @param {Object} obj\r\n * @return {String} object type\r\n */\r\nfunction getType(obj) {\r\n  return Object.prototype.toString.call(obj);\r\n};\r\n\r\n// HACK: 验证的时候，不作trim处理\r\nutils.trim = function(str) {\r\n  return str.replace(/^\\s+|\\s$/g, '');\r\n};\r\n\r\n/**\r\n * Utils: isArray\r\n * @param {Object} obj\r\n * @return {Boolean} is Array or not\r\n */\r\nfunction isArray(obj) {\r\n  return getType(obj) === TYPE_ARRAY;\r\n};\r\n\r\n/**\r\n * Utils: isFunction\r\n * @param {Object} obj\r\n * @return {Boolean} is Function or not\r\n */\r\nfunction isFunction(obj) {\r\n  return getType(obj) === TYPE_FUNCTION;\r\n};\r\n\r\n/**\r\n * Utils: getValue\r\n * @param {HTMLElement} htmlElement\r\n * @return {String} value of htmlElement\r\n */\r\nfunction getValue(htmlElement) {\r\n  return htmlElement.value || htmlElement.getAttribute('data-value') || '';\r\n}\r\n\r\n/**\r\n * 解析length规则的参数\r\n * @param {String} paramString\r\n * @return {Array} params\r\n */\r\nutils.getLengthParams = function(paramString) {\r\n  var errorString = 'The parameters for length is illegal.';\r\n  paramString = paramString[0]; // HACK: 假设只有一个参数\r\n  var matcher = /\\s*([\\(\\[])\\s*(\\d+)?\\s*,\\s*(\\d+)?\\s*([\\)\\]])\\s*/; // 如果没有最小限制，最小限制为0；如果没有最大限制，最大限制为Infinite\r\n  var result = paramString.match(matcher);\r\n  if (result === null) {\r\n    throw new TypeError(errorString);\r\n  }\r\n  var min = result[2], max = result[3];\r\n  if (typeof min === TYPE_UNDEFINED) {\r\n    min = 0;\r\n  } else if (result[1] === '(') {\r\n    min = +min+1;\r\n  } else if (result[1] === '[') {\r\n    min = +min;\r\n  } else {\r\n    throw new TypeError(errorString);\r\n  }\r\n  if (typeof max === TYPE_UNDEFINED) {\r\n    max = Infinity;\r\n  } else if (result[4] === ')') {\r\n    max = +max-1;\r\n  } else if (result[4] === ']'){\r\n    max = +max;\r\n  } else {\r\n    throw new TypeError(errorString);\r\n  }\r\n  if (min !== min || max !== max) {\r\n    throw new TypeError(errorString);\r\n  }\r\n  return [min, max];\r\n};\r\n\r\n/**\r\n * 解析range规则的参数\r\n * @param {String} paramString\r\n * @return {Array} params\r\n * @throws {TypeError} 'The parameters for range is illegal.'\r\n * TODO: 类似length规则\r\n */\r\nutils.getRangeParams = function(paramString) {\r\n  var errorString = 'The parameters for range is illegal.';\r\n  paramString = paramString[0];\r\n  var matcher = /\\s*([\\(\\[])\\s*((0|([\\+\\-]?[1-9]\\d*))(\\.[0-9]+)?)?\\s*,\\s*((0|([\\+\\-]?[1-9]\\d*))(\\.[0-9]+)?)?\\s*([\\)\\]])\\s*/; // 如果没有最小限制，最小限制为负无穷；如果没有最大限制，最大限制为正无穷\r\n  var result = paramString.match(matcher);\r\n  if (result === null) {\r\n    throw new TypeError(errorString);\r\n  }\r\n  var min = result[2], max = result[6], leftEqual, rightEqual;\r\n  if (typeof min === TYPE_UNDEFINED) {\r\n    min = -Infinity;\r\n  } else {\r\n    min = +min;\r\n  }\r\n  leftEqual = result[1] === '[';\r\n  if (typeof max === TYPE_UNDEFINED) {\r\n    max = Infinity;\r\n  } else {\r\n    max = +max;\r\n  }\r\n  rightEqual = result[10] === ']';\r\n  return [leftEqual, min, max, rightEqual];\r\n};\r\n\r\nvar priorityTable = {\r\n  \"||\": 0,\r\n  \"&&\": 1,\r\n  \"!\": 2\r\n};\r\n\r\nfunction priority(v1, v2) {\r\n  return priorityTable[v1] >= priorityTable[v2];\r\n}\r\n\r\n/**\r\n * parse rules\r\n * 解析规则字符串，获取规则名称，规则参数，与或非逻辑\r\n * 用花括号表示分组，因为小括号和中括号已经作为参数有用\r\n * @param {String} ruleString\r\n * @return {Array} rules\r\n */\r\nfunction parseRules(ruleString) { // 假设输入为： \"{A||!B}&&C\"\r\n  var wordQueue = []; // 词队列\r\n  var exQueue = []; // 后缀表达式队列\r\n  var opStack = []; // 操作符栈\r\n  // 1. 分词：wordQueue = ['{', 'A', '||', '!', 'B', '}', '&&', 'C']\r\n  var i = 0, c, word = '', op = '', len = ruleString.length;\r\n  while (i < len) {\r\n    c = ruleString[i++];\r\n    switch (c) {\r\n      case '{':\r\n      case '}':\r\n      case '!':\r\n        if (word.length > 0) {\r\n          wordQueue.push(word);\r\n        }\r\n        wordQueue.push(c);\r\n        word = '';\r\n        break;\r\n      case '&':\r\n      case '|':\r\n        if (c === op) {\r\n          if (word.length > 0) {\r\n            wordQueue.push(word);\r\n          }\r\n          wordQueue.push(op+op);\r\n          word = '';\r\n          op = '';\r\n        } else {\r\n          op += c;\r\n        }\r\n        break;\r\n      default:\r\n        word += c;\r\n    }\r\n  }\r\n  if (word.length > 0) {\r\n    wordQueue.push(word);\r\n  }\r\n  // 2. 将中缀转成后缀并输入后缀表达式栈：exQueue = ['A', 'B', '!', '||', 'C', '&&'];\r\n  i = 0;\r\n  len = wordQueue.length;\r\n  var j, pop;\r\n  while(i < len) {\r\n    c = wordQueue[i++];\r\n    switch (c) {\r\n      case '{':\r\n        opStack.push(c);\r\n        break;\r\n      case '||':\r\n      case '&&':\r\n      case '!':\r\n        j = opStack.length - 1;\r\n        while(j >= 0 && (opStack[j] === '||' ||  opStack[j] === '&&' || opStack[j] === '!')) {\r\n          if (priority(opStack[j], c)) { // 如果栈顶操作符优先级比较大或相等，就出栈\r\n            exQueue.push(opStack.pop());\r\n          } else {\r\n            break;\r\n          }\r\n          j--;\r\n        }\r\n        opStack.push(c);\r\n        break;\r\n      case '}':\r\n        j = opStack.length - 1;\r\n        while(j >= 0) {\r\n          pop = opStack.pop();\r\n          if (pop === '{') {\r\n            break;\r\n          }\r\n          exQueue.push(pop);\r\n          j--;\r\n        }\r\n        break;\r\n      default:\r\n        exQueue.push(c);\r\n    }\r\n  }\r\n  if (opStack.length > 0) {\r\n    j = opStack.length - 1;\r\n    while(j >= 0) {\r\n      pop = opStack.pop();\r\n      if (pop === '{') {\r\n        break;\r\n      }\r\n      exQueue.push(pop);\r\n      j--\r\n    }\r\n  }\r\n  // console.log('转成后缀：' + exQueue);\r\n  return exQueue;\r\n}\r\n\r\n/**\r\n * execute checker\r\n * @param {String} type\r\n * @param {Array} values\r\n * @param {Boolean} isApi\r\n * @return {Boolean} result\r\n * TODO:所有的checker都将传入一个values数组作为参数，但是返回值不同，可能返回布尔矩阵（数组），或者布尔值\r\n */\r\nfunction execFn(type, values, isApi) {\r\n  var parts = type.split(':');\r\n  type = parts[0].replace(/length/i, 'long');\r\n  var checker = isApi ? apiCheckers[type] || defaultCheckers[type] : this.cs[type] || apiCheckers[type] || defaultCheckers[type];\r\n\r\n  var result;\r\n  switch(getType(checker)) {\r\n    // checker可能不是函数，checker可能是由另外一些规则组成的表达式，所以要继续计算\r\n    case TYPE_ARRAY:\r\n      result = calculateRules.call(this, checker, values, isApi);\r\n      break;\r\n    case TYPE_FUNCTION:\r\n      var params;\r\n      var _params = parts.slice(1);\r\n      switch (type) {\r\n        case 'long':\r\n          params = utils.getLengthParams(_params);\r\n          break;\r\n        case 'range':\r\n          params = utils.getRangeParams(_params);\r\n          break;\r\n        default:\r\n          params = _params;\r\n      }\r\n      if (isApi) {\r\n        params.unshift(values);\r\n      } else {\r\n        var _values  = [];\r\n        for (var k = 0; k < values.length; ++k) {\r\n          _values.push(getValue(values[k]));\r\n        }\r\n        params.unshift(_values);\r\n      }\r\n      result = checker.apply(null, params);\r\n      break;\r\n    default:\r\n      throw new TypeError('Checker for rule ' + parts[0] + ' must be a Function.');\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * 执行后缀表达式运算\r\n * @param {Array} ruleQueue\r\n * @param {Array} values\r\n * @return {Boolean} result\r\n * TODO: 使用基于矩阵（数组）的与或非运算\r\n */\r\nfunction calculateRules(ruleQueue, values, isApi) {\r\n\r\n  var ruleStack = [];\r\n  for (var k = 0; k < ruleQueue.length; ++k) {\r\n    var exp = ruleQueue[k];\r\n    switch (exp) {\r\n      case '&&':\r\n        var s2 = ruleStack.pop()\r\n          , s1 = ruleStack.pop();\r\n        var result = (getType(s1) === TYPE_STRING ? execFn.call(this, s1, values, isApi) : s1) && (getType(s2) === TYPE_STRING ? execFn.call(this, s2, values, isApi) : s2);\r\n        ruleStack.push(result);\r\n        break;\r\n      case '||':\r\n        var s2 = ruleStack.pop()\r\n          , s1 = ruleStack.pop();\r\n        var result = (getType(s1) === TYPE_STRING ? execFn.call(this, s1, values, isApi) : s1) || (getType(s2) === TYPE_STRING ? execFn.call(this, s2, values, isApi) : s2);\r\n        ruleStack.push(result);\r\n        break;\r\n      case '!':\r\n        var s1 = ruleStack.pop();\r\n        var result = !(getType(s1) === TYPE_STRING ? execFn.call(this, s1, values, isApi) : s1);\r\n        ruleStack.push(result);\r\n        break;\r\n      default:\r\n        ruleStack.push(exp);\r\n    }\r\n  }\r\n  var pop = ruleStack.pop();\r\n  return getType(pop) === TYPE_STRING ? execFn.call(this, pop, values, isApi) : pop;\r\n\r\n}\r\n\n/**\r\n * @constructor\r\n * @class Validator\r\n * @param {Array|Object} validations\r\n */\r\nfunction Validator(validations) {\r\n  validations = validations || [];\r\n  this.cs = {};\r\n  this.vs = [];\r\n  if (!isArray(validations)) {\r\n    validations = [validations];\r\n  }\r\n  for (var i = 0; i < validations.length; ++i) {\r\n    var fields = validations[i].field;\r\n    if (!isArray(fields)) {\r\n      fields = [fields];\r\n    }\r\n    var rules = validations[i].rules;\r\n    rules = isArray(rules) ? rules : [rules];\r\n    for (var k = 0; k < rules.length; ++k) {\r\n      rules[k].queue = parseRules(rules[k].type);\r\n    }\r\n    this.vs.push({\r\n      $fs: fields,\r\n      rs: rules\r\n    });\r\n  }\r\n};\r\n\r\nvar vprtt = Validator.prototype;\r\n\r\n/**\r\n * @method .add(rules)\r\n * 添加自定义规则\r\n * @param {Object} rules\r\n * @return this\r\n * this.checkers可以是函数，或者checker表达式队列\r\n */\r\nvprtt.add = function(rules) {\r\n  function setRule(name, rule) {\r\n    var checker = rule;\r\n    var callback;\r\n    switch (getType(checker)) {\r\n      case TYPE_FUNCTION:\r\n        callback = checker;\r\n        break;\r\n      case TYPE_STRING:\r\n        // 解析规则，生成的是一个后缀表达式\r\n        // 可以使用defaultCheckers或者apiCheckers\r\n        // 此处不直接生成checker函数，而是把表达式解析成后缀形式（队列存储），在验证的时候（执行.check()时）再执行表达式运算\r\n        try {\r\n          callback = parseRules(checker);\r\n        } catch(error) {\r\n          throw new Error(\"Cannot parse rule expression.\");\r\n        }\r\n\r\n        break;\r\n      case TYPE_REGEXP:\r\n        callback = function(values) {\r\n          var pass = true;\r\n          if (isArray(values)) {\r\n            for (var i = 0, len = values.length; i < len; ++i) {\r\n              if (!checker.test(values[i])) {\r\n                pass = false;\r\n                break;\r\n              }\r\n            }\r\n          } else {\r\n            if (!rule.rule.test(values)) {\r\n              pass = false;\r\n            }\r\n          }\r\n          return pass;\r\n        };\r\n        break;\r\n      default:\r\n        throw new TypeError('Rule type not support.');\r\n    }\r\n    this.cs[name] = callback;\r\n  }\r\n\r\n  for (var name in rules) {\r\n    if (hasOwn.call(rules, name)) {\r\n      setRule.call(this, name, rules[name]);\r\n    }\r\n  }\r\n  return this;\r\n};\r\n\r\n/**\r\n * @method .check()\r\n * @return {Boolean} pass or not\r\n */\r\nvprtt.check = function(obj) {\r\n  var pass = true;\r\n  var validations = this.vs;\r\n  for (var i = 0; i < validations.length; ++i) {\r\n    var $fields = validations[i].$fs;\r\n    var rules = validations[i].rs;\r\n    for (var j = 0; j < rules.length; ++j) {\r\n      var rule = rules[j];\r\n      // 现在开始解析后缀表达式\r\n      pass = calculateRules.call(this, rule.queue, $fields, false);\r\n      if (!pass) {\r\n        var context = $fields.length < 2 ? $fields[0] : $fields;\r\n        rule.fail.call(context, obj);\r\n        break;\r\n      }\r\n    }\r\n    if (!pass) break;\r\n  }\r\n  return pass;\r\n};\r\n\r\n/**\r\n * @method .remove(rules)\r\n * 移除自定义规则\r\n * @param {Array|String} rules\r\n * @return this\r\n */\r\nvprtt.remove = function(rules) {\r\n  function removeRule(rule) {\r\n    if (typeof this.cs[rule] !== TYPE_UNDEFINED) {\r\n      delete this.cs[rule];\r\n    }\r\n  }\r\n  if (isArray(rules)) {\r\n    for (var i = 0, len = rules.length; i < len; ++i) {\r\n      removeRule.call(this, rules[i]);\r\n    }\r\n  } else {\r\n    removeRule.call(this, rules);\r\n  }\r\n  return this;\r\n};\r\n\n// checker函数的第一个参数总是一个数组，这个数组就是待检测的字符串数组\r\n// 从第二个参数起，每个checker函数带有不同长度的参数列表。例如，empty函数的参数列表长度为0，long函数的参数列表长度为2（暂时，有待改进）\r\nvar defaultCheckers = {};\r\n\r\nvar defaultMatchers = {\r\n  // url\r\n  url: /^(https?:\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]{2,6})([\\/\\w \\.-]*)*\\/?$/\r\n  // email\r\n  , email: /^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$/i\r\n  // 数值型\r\n  , number: /^(0|([\\+\\-]?[1-9]\\d*))(\\.[0-9]+)?$/\r\n  // 整型\r\n  , int: /^(0|([\\+\\-]?[1-9]\\d*))$/\r\n  // 正整数\r\n  , positive: /^\\+?[1-9]\\d*$/\r\n  // 负整数\r\n  , negative: /^\\-[1-9]\\d*$/\r\n  // 变量名：只能包含英文字母/数字/下划线，且不能以数字开头\r\n  , varName: /^[a-zA-Z_][a-zA-Z0-9_]*$/\r\n  // 昵称：只能包含中文/英文字母/数字/下划线，且不能以数字开头\r\n  , nickName: /^[\\u4E00-\\u9FA5\\uF900-\\uFA2Da-zA-Z_][\\u4E00-\\u9FA5\\uF900-\\uFA2Da-zA-Z0-9_]*$/\r\n  // QQ\r\n  , QQ: /^[1-9][0-9]{4,}$/\r\n  // 身份证号\r\n  // 手机号\r\n  // 电话号码\r\n  // 邮政编码\r\n  // IP\r\n  , ip: /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\\-]*[a-zA-Z0-9])\\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\\-]*[A-Za-z0-9])$|^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/\r\n  // IPV4\r\n  , ipv4: /^(?:(?:\\d|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:\\d|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])$/\r\n  // IPV6\r\n  , ipv6: /^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\\-]*[a-zA-Z0-9])\\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\\-]*[A-Za-z0-9])$|^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/\r\n  // 全大写\r\n  , upperCase: /^[A-Z]+$/\r\n  // 全小写\r\n  , lowerCase: /^[a-z]+$/\r\n  // 空限制\r\n  , empty: empty\r\n  // 相等\r\n  , equal: equal\r\n  // 长度范围限制\r\n  , long: long\r\n  // 数值大小限制\r\n  , range: range\r\n};\r\n\r\n/**\r\n * 判断值是否为空\r\n * @param {Object} value\r\n * 如果value为null|undefined|空字符串，就判断为真，否则判断为假\r\n * @return {Boolean} 是否为空\r\n */\r\nfunction isEmpty(value) {\r\n  return value === null || typeof value === TYPE_UNDEFINED || value === '';\r\n}\r\n\r\n/**\r\n * defaults.checkers: equal check\r\n * TODO: 引入布尔矩阵运算\r\n * @param {Array} values\r\n * @return {Boolean} equal or not\r\n */\r\nfunction equal(values) {\r\n  if (!isArray(values)) {\r\n    return false;\r\n  }\r\n  var equal = true;\r\n  for (var i = 0; i < values.length - 1; ++i) {\r\n    if (values[i] !== values[i+1]) {\r\n      equal = false;\r\n      break;\r\n    }\r\n  }\r\n  return equal;\r\n}\r\n\r\n/**\r\n * defaults.checkers: empty check\r\n * TODO: 引入布尔矩阵运算\r\n * @param {String|Array} values\r\n * @return {Boolean|Array} 如果传入数组，就返回布尔数组；如果传入字符串，就返回布尔值\r\n */\r\nfunction empty(values) {\r\n  var pass;\r\n  if (isArray(values)) {\r\n    pass = true;\r\n    for (var i = 0; i < values.length; ++i) {\r\n      if (!isEmpty(values[i])) {\r\n        pass = false;\r\n        break;\r\n      }\r\n    }\r\n  } else {\r\n    pass = isEmpty(values);\r\n  }\r\n  return pass;\r\n}\r\n\r\n/**\r\n * defaults.checkers: length check\r\n * TODO: 引入布尔矩阵运算\r\n * @param {Array|String} values\r\n * @param {Number} min\r\n * @param {Number} max\r\n * @return {Array|Boolean} 如果传入数组，就返回布尔矩阵；如果传入字符串，就返回布尔值\r\n */\r\nfunction long(values, min, max) {\r\n  var pass, length;\r\n  min = min || -Infinity;\r\n  max = max || Infinity;\r\n  if (isArray(values)) {\r\n    pass = true;\r\n    for (var i = 0; i < values.length; ++i) {\r\n      length = values[i].length;\r\n      if (length < min || length > max) {\r\n        pass = false;\r\n        break;\r\n      }\r\n    }\r\n  } else {\r\n    length = values.length;\r\n    pass = length >= min && length <= max;\r\n  }\r\n  return pass;\r\n}\r\n\r\n/**\r\n * defaults.check: number range check\r\n * 这个函数和long类似，但是不是用来限制长度的，而是用来限制数值本身的\r\n * HACK: 这个函数的五个参数缺一不可\r\n * HACK: values应该转成Number型，因为参数很可能是字符串，可能会引起判断错误\r\n * @param {Array|String} values\r\n * @param {Boolean} leftEqual 是否大于等于\r\n * @param {Number} min\r\n * @param {Number} max\r\n * @param {Boolean} rightEqual 是否小于等于\r\n * @return {Array|Boolean} 如果传入数组，就返回布尔矩阵；否则就返回布尔值\r\n */\r\nfunction range(values, leftEqual, min, max, rightEqual) {\r\n  var pass;\r\n  if (isArray(values)) {\r\n    pass = true;\r\n    for (var i = 0; i < values.length; ++i) {\r\n      var value = Number(values[i]);\r\n      if (leftEqual && value < min || rightEqual && value > max || !leftEqual && value <= min || !rightEqual && value >= max) {\r\n        pass = false;\r\n        break;\r\n      }\r\n    }\r\n  } else {\r\n    values = Number(values);\r\n    pass = (leftEqual && values >= min || !leftEqual && values > min) && (rightEqual && values <= max || !rightEqual && values < max);\r\n  }\r\n  return pass;\r\n}\r\n\nvar apiCheckers = {};\r\n\r\n/**\r\n * @static Validator.is\r\n * 优先级： api.checkers > defaults.checkers\r\n * @param {String} ruleName\r\n * @param {String} value\r\n * @return {Boolean} is or not\r\n */\r\nvar is = Validator.is = function(ruleName, value) {\r\n  var checker = apiCheckers[ruleName] || defaultCheckers[ruleName];\r\n  var result;\r\n  switch(getType(checker)) {\r\n    case TYPE_ARRAY:\r\n      result = calculateRules.call(this, checker, value, true);\r\n      break;\r\n    case TYPE_FUNCTION:\r\n      result = checker(value);\r\n      break;\r\n    default:\r\n      throw new TypeError('Checker for ' + ruleName + ' is not defined.');\r\n  }\r\n  return result;\r\n};\r\n\r\n/**\r\n * @static Validator.not\r\n * @param {String} ruleName\r\n * @param {String} testString\r\n * @return {Boolean} is or not\r\n */\r\nvar not = Validator.not = function(ruleName, value) {\r\n  return !is(ruleName, value);\r\n};\r\n\r\n// TODO: 增加Validator.any(),Validator.all()\r\n\r\n/**\r\n * This helper helps to regist default checkers, `is` api and `not` api\r\n * 所有的defaultCheckers都是函数\r\n * @param {String} name\r\n * @param {Object} matcher\r\n */\r\nfunction registDefaultCheckers(name, matcher) {\r\n  var callback;\r\n  switch(getType(matcher)) {\r\n    case TYPE_REGEXP:\r\n      // value may be an array or string\r\n      // TODO:如果传入数组，就返回布尔数组\r\n      // 如果是字符串，就返回布尔值\r\n      callback = function(value) {\r\n        var pass;\r\n        if (isArray(value)) {\r\n          pass = true;\r\n          for (var i = 0; i < value.length; ++i) {\r\n            if (!matcher.test(value[i])) {\r\n              pass = false;\r\n              break;\r\n            }\r\n          }\r\n        } else {\r\n          pass = matcher.test(value);\r\n        }\r\n        return pass;\r\n      };\r\n      break;\r\n    case TYPE_FUNCTION:\r\n      callback = matcher;\r\n      break;\r\n    default:\r\n      throw new TypeError('Matcher Type Error.');\r\n  }\r\n  defaultCheckers[name] = callback;\r\n  is[name] = callback;\r\n  not[name] = function() {\r\n    return !callback.apply(null, arguments);\r\n  };\r\n}\r\n\r\nfor (var m in defaultMatchers) {\r\n  if (hasOwn.call(defaultMatchers, m)) {\r\n    registDefaultCheckers(m, defaultMatchers[m]);\r\n  }\r\n}\r\n\r\n/**\r\n * @param {String} type\r\n * @param {String|RegExp|Function} checker\r\n * checker可以是字符串，正则表达式，或者函数\r\n * 当checker是字符串时，表示基于内建规则组合（表达式）的新规则\r\n * 当checker是正则表达式时，表示一条规则，它必须通过该正则表达式的完全匹配\r\n * TODO: 当checker是函数时，该函数的返回值必须是布尔型或者布尔矩阵\r\n * This function may throw a `TypeError` if checker's type is not support.\r\n */\r\nfunction registApiChecker(type, checker) {\r\n  var callback;\r\n  switch(getType(checker)) {\r\n    case TYPE_STRING:\r\n      // 解析规则，生成的是一个后缀表达式（队列）\r\n      // 只能使用defaultCheckers，如果defaultCheckers里没有，就抛出异常\r\n      // 此处不直接生成checker函数，而是把表达式解析成后缀形式（队列存储），在验证的时候（执行.check()或者Validator.is()/Validator.not()时）再执行表达式运算\r\n      var queue;\r\n      try {\r\n        queue = parseRules(checker);\r\n      } catch(err) {\r\n        throw new Error(err);\r\n      }\r\n      callback = queue;\r\n      break;\r\n    case TYPE_REGEXP:\r\n      callback = function(value) {\r\n        var pass = true;\r\n        if (isArray(value))  {\r\n          for (var i = 0; i < value.length; ++i) {\r\n            if (!checker.test(value[i])) {\r\n              pass = false;\r\n              break;\r\n            }\r\n          }\r\n        } else {\r\n          pass = checker.test(value);\r\n        }\r\n        return pass;\r\n      }\r\n      break;\r\n    case TYPE_FUNCTION:\r\n      callback = checker;\r\n      break;\r\n    default:\r\n      throw new TypeError('Checker must be a String/RegExp/Function.');\r\n  }\r\n  apiCheckers[type] = callback;\r\n}\r\n\r\n/**\r\n * @static Validator.api(rules)\r\n * @param {Object} rules\r\n * @return Validator\r\n */\r\nValidator.api = function(rules) {\r\n\r\n  for (var name in rules) {\r\n    if (hasOwn.call(rules, name)) {\r\n      registApiChecker.call(this, name, rules[name]);\r\n    }\r\n  }\r\n  return this;\r\n\r\n};\r\n\r\n// just for test\r\nValidator.api.list = function() {\r\n  console.log(apiCheckers);\r\n};\r\n\n// 暂时不做扩展：没有必要做扩展了，已经够用了\n\n/**\r\n * @constructor\r\n * @class FormValidator\r\n * @extends Validator\r\n * @param {HTMLElement|String} formOrSelector\r\n * @param {Object|Array} validations\r\n * TODO: 增加对checkbox,radio的支持\r\n */\r\nvar FormValidator = function(formOrSelector, validations) {\r\n  this.vs = [];\r\n  this.cs = {};\r\n  if (typeof formOrSelector === 'string') {\r\n    this.$form = document.querySelectorAll(formOrSelector)[0]; // TODO: querySelectorAll兼容性\r\n  } else {\r\n    this.$form = formOrSelector;\r\n  }\r\n  validations = validations || [];\r\n  if (!isArray(validations)) {\r\n    validations = [validations];\r\n  }\r\n  for (var i = 0, len = validations.length; i < len; ++i) {\r\n    var fields = validations[i].field;\r\n    if (!isArray(fields)) {\r\n      fields = [fields];\r\n    }\r\n    var $fields = [];\r\n    for (var j = 0; j < fields.length; ++j) {\r\n      var $field = this.$form.querySelectorAll('[name=' + fields[j] + ']')[0] || this.$form.querySelectorAll('[data-name=' + fields[j] + ']')[0]; // TODO: querySelectorAll兼容性\r\n      if (typeof $field === TYPE_UNDEFINED) {\r\n        throw new TypeError('未找到域：' + fields[j]);\r\n      }\r\n      $fields.push($field);\r\n    }\r\n    var rules = validations[i].rules;\r\n    rules = isArray(rules) ? rules : [rules];\r\n    for (var k = 0; k < rules.length; ++k) {\r\n      rules[k].queue = parseRules(rules[k].type);\r\n    }\r\n    this.vs.push({\r\n      $fs: $fields,\r\n      rs: rules\r\n    });\r\n  }\r\n};\r\n\r\nFormValidator.prototype = new Validator();\r\nFormValidator.prototype.constructor = FormValidator;\r\n\r\n/**\r\n * @method .check()\r\n * @override Validator.prototype.check()\r\n * @return {Boolean} pass or not\r\n * TODO: 增加对checkbox和radio的支持\r\n */\r\nFormValidator.prototype.check = function() {\r\n  return Validator.prototype.check.call(this, this.$form);\r\n};\r\n\n\r\nexports.Validator = Validator;\r\n\r\nexports.FormValidator = FormValidator;\r\n\r\n}));\r\n"],"sourceRoot":"/source/"}